{"version":3,"file":"progress-load.js","names":["addScript","src","onLoad","resolve","script","document","createElement","setAttribute","addEventListener","head","appendChild","progressLoaded","type","updateProgressBar","progressBar","loaded","max","percent","Math","round","toString","progressLoad","onProgress","Promise","reject","sessionStorage","getItem","req","XMLHttpRequest","evt","blobURL","URL","createObjectURL","Blob","response","setItem","err","open","send"],"sources":["../../source/javascript/progress-load.js"],"sourcesContent":["function addScript(src, onLoad, resolve){\n  onLoad();\n  const script = document.createElement('script');\n  script.setAttribute('src', src);\n  script.addEventListener('load', () => resolve());\n  document.head.appendChild(script);\n}\n\nfunction progressLoaded(src, type, onLoad, resolve){\n  if(type === 'script'){\n    addScript(src, onLoad, resolve);\n    return;\n  }\n\n  onLoad();\n  resolve();\n}\n\nfunction updateProgressBar(progressBar, loaded, max){\n  const percent = Math.round( (loaded / max) * 100 );\n  progressBar.setAttribute('value', percent.toString(10));\n}\n\nfunction progressLoad(src, type=\"script\", onProgress=()=>{}, onLoad=()=>{}){\n  return new Promise(( resolve, reject )=>{\n    //guard: script loaded.\n    if(sessionStorage.getItem(`loaded:${src}`) === 'ready'){\n      progressLoaded(src, type, onLoad, resolve);\n      return;\n    }\n\n    //use ajax to monitor loading progress\n    const req = new XMLHttpRequest();\n    req.addEventListener(\"progress\", evt => onProgress(evt));\n\n    req.addEventListener(\"load\", () => {\n      const blobURL = URL.createObjectURL(new Blob([req.response]));\n      progressLoaded(blobURL, type, onLoad, resolve);\n      sessionStorage.setItem(`loaded:${src}`, 'ready');\n    });\n\n    req.addEventListener(\"error\", (err) => reject(err));\n    req.open(\"GET\", src);\n    req.send();\n  })\n}"],"mappings":"AAAA,SAASA,SAAT,CAAmBC,GAAnB,EAAwBC,MAAxB,EAAgCC,OAAhC,EAAwC;EACtCD,MAAM;EACN,MAAME,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;EACAF,MAAM,CAACG,YAAP,CAAoB,KAApB,EAA2BN,GAA3B;EACAG,MAAM,CAACI,gBAAP,CAAwB,MAAxB,EAAgC,MAAML,OAAO,EAA7C;EACAE,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,MAA1B;AACD;;AAED,SAASO,cAAT,CAAwBV,GAAxB,EAA6BW,IAA7B,EAAmCV,MAAnC,EAA2CC,OAA3C,EAAmD;EACjD,IAAGS,IAAI,KAAK,QAAZ,EAAqB;IACnBZ,SAAS,CAACC,GAAD,EAAMC,MAAN,EAAcC,OAAd,CAAT;IACA;EACD;;EAEDD,MAAM;EACNC,OAAO;AACR;;AAED,SAASU,iBAAT,CAA2BC,WAA3B,EAAwCC,MAAxC,EAAgDC,GAAhD,EAAoD;EAClD,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAaJ,MAAM,GAAGC,GAAV,GAAiB,GAA7B,CAAhB;EACAF,WAAW,CAACP,YAAZ,CAAyB,OAAzB,EAAkCU,OAAO,CAACG,QAAR,CAAiB,EAAjB,CAAlC;AACD;;AAED,SAASC,YAAT,CAAsBpB,GAAtB,EAA2BW,IAAI,GAAC,QAAhC,EAA0CU,UAAU,GAAC,MAAI,CAAE,CAA3D,EAA6DpB,MAAM,GAAC,MAAI,CAAE,CAA1E,EAA2E;EACzE,OAAO,IAAIqB,OAAJ,CAAY,CAAEpB,OAAF,EAAWqB,MAAX,KAAqB;IACtC;IACA,IAAGC,cAAc,CAACC,OAAf,CAAwB,UAASzB,GAAI,EAArC,MAA4C,OAA/C,EAAuD;MACrDU,cAAc,CAACV,GAAD,EAAMW,IAAN,EAAYV,MAAZ,EAAoBC,OAApB,CAAd;MACA;IACD,CALqC,CAOtC;;;IACA,MAAMwB,GAAG,GAAG,IAAIC,cAAJ,EAAZ;IACAD,GAAG,CAACnB,gBAAJ,CAAqB,UAArB,EAAiCqB,GAAG,IAAIP,UAAU,CAACO,GAAD,CAAlD;IAEAF,GAAG,CAACnB,gBAAJ,CAAqB,MAArB,EAA6B,MAAM;MACjC,MAAMsB,OAAO,GAAGC,GAAG,CAACC,eAAJ,CAAoB,IAAIC,IAAJ,CAAS,CAACN,GAAG,CAACO,QAAL,CAAT,CAApB,CAAhB;MACAvB,cAAc,CAACmB,OAAD,EAAUlB,IAAV,EAAgBV,MAAhB,EAAwBC,OAAxB,CAAd;MACAsB,cAAc,CAACU,OAAf,CAAwB,UAASlC,GAAI,EAArC,EAAwC,OAAxC;IACD,CAJD;IAMA0B,GAAG,CAACnB,gBAAJ,CAAqB,OAArB,EAA+B4B,GAAD,IAASZ,MAAM,CAACY,GAAD,CAA7C;IACAT,GAAG,CAACU,IAAJ,CAAS,KAAT,EAAgBpC,GAAhB;IACA0B,GAAG,CAACW,IAAJ;EACD,CApBM,CAAP;AAqBD"}